#!/bin/bash

# 简单的图标清理脚本
set -euo pipefail

echo "=== 清理所有Shell脚本中的图标 ==="

# 查找所有.sh文件
find /root/scripts-for-linux -name "*.sh" -type f | while read -r file; do
    echo "处理文件: $file"
    
    # 检查是否包含图标
    if grep -q "[🚀📥❌✅🧹🔧🐚🛠️🔐🐳📦🎯💡🔄⚠️📝📋🎨🎉🔍🌐👤🎁⏭️🔌⚙️📁]" "$file" 2>/dev/null; then
        echo "  发现图标，正在清理..."
        
        # 创建备份
        cp "$file" "$file.backup"
        
        # 移除图标
        sed -i 's/🚀//g; s/📥//g; s/❌//g; s/✅//g; s/🧹//g; s/🔧//g; s/🐚//g; s/🛠️//g; s/🔐//g; s/🐳//g; s/📦//g; s/🎯//g; s/💡//g; s/🔄//g; s/⚠️//g; s/📝//g; s/📋//g; s/🎨//g; s/🎉//g; s/🔍//g; s/🌐//g; s/👤//g; s/🎁//g; s/⏭️//g; s/🔌//g; s/⚙️//g; s/📁//g' "$file"
        
        # 替换数字图标
        sed -i 's/1️⃣/1./g; s/2️⃣/2./g; s/3️⃣/3./g; s/4️⃣/4./g; s/5️⃣/5./g; s/6️⃣/6./g; s/7️⃣/7./g; s/8️⃣/8./g; s/9️⃣/9./g; s/0️⃣/0./g' "$file"
        
        echo "  ✓ 清理完成"
    else
        echo "  ✓ 无图标，跳过"
    fi
done

echo
echo "=== 验证清理结果 ==="

# 检查是否还有图标
remaining_files=$(find /root/scripts-for-linux -name "*.sh" -type f -exec grep -l "[🚀📥❌✅🧹🔧🐚🛠️🔐🐳📦🎯💡🔄⚠️📝📋🎨🎉🔍🌐👤🎁⏭️🔌⚙️📁]" {} \; 2>/dev/null | wc -l)

if [ "$remaining_files" -eq 0 ]; then
    echo "✓ 所有图标已成功清理"
else
    echo "⚠ 仍有 $remaining_files 个文件包含图标"
    find /root/scripts-for-linux -name "*.sh" -type f -exec grep -l "[🚀📥❌✅🧹🔧🐚🛠️🔐🐳📦🎯💡🔄⚠️📝📋🎨🎉🔍🌐👤🎁⏭️🔌⚙️📁]" {} \; 2>/dev/null || true
fi

echo "=== 清理完成 ==="
