#!/bin/bash

# ç®€å•çš„å›¾æ ‡æ¸…ç†è„šæœ¬
set -euo pipefail

echo "=== æ¸…ç†æ‰€æœ‰Shellè„šæœ¬ä¸­çš„å›¾æ ‡ ==="

# æŸ¥æ‰¾æ‰€æœ‰.shæ–‡ä»¶
find /root/scripts-for-linux -name "*.sh" -type f | while read -r file; do
    echo "å¤„ç†æ–‡ä»¶: $file"
    
    # æ£€æŸ¥æ˜¯å¦åŒ…å«å›¾æ ‡
    if grep -q "[ğŸš€ğŸ“¥âŒâœ…ğŸ§¹ğŸ”§ğŸšğŸ› ï¸ğŸ”ğŸ³ğŸ“¦ğŸ¯ğŸ’¡ğŸ”„âš ï¸ğŸ“ğŸ“‹ğŸ¨ğŸ‰ğŸ”ğŸŒğŸ‘¤ğŸâ­ï¸ğŸ”Œâš™ï¸ğŸ“]" "$file" 2>/dev/null; then
        echo "  å‘ç°å›¾æ ‡ï¼Œæ­£åœ¨æ¸…ç†..."
        
        # åˆ›å»ºå¤‡ä»½
        cp "$file" "$file.backup"
        
        # ç§»é™¤å›¾æ ‡
        sed -i 's/ğŸš€//g; s/ğŸ“¥//g; s/âŒ//g; s/âœ…//g; s/ğŸ§¹//g; s/ğŸ”§//g; s/ğŸš//g; s/ğŸ› ï¸//g; s/ğŸ”//g; s/ğŸ³//g; s/ğŸ“¦//g; s/ğŸ¯//g; s/ğŸ’¡//g; s/ğŸ”„//g; s/âš ï¸//g; s/ğŸ“//g; s/ğŸ“‹//g; s/ğŸ¨//g; s/ğŸ‰//g; s/ğŸ”//g; s/ğŸŒ//g; s/ğŸ‘¤//g; s/ğŸ//g; s/â­ï¸//g; s/ğŸ”Œ//g; s/âš™ï¸//g; s/ğŸ“//g' "$file"
        
        # æ›¿æ¢æ•°å­—å›¾æ ‡
        sed -i 's/1ï¸âƒ£/1./g; s/2ï¸âƒ£/2./g; s/3ï¸âƒ£/3./g; s/4ï¸âƒ£/4./g; s/5ï¸âƒ£/5./g; s/6ï¸âƒ£/6./g; s/7ï¸âƒ£/7./g; s/8ï¸âƒ£/8./g; s/9ï¸âƒ£/9./g; s/0ï¸âƒ£/0./g' "$file"
        
        echo "  âœ“ æ¸…ç†å®Œæˆ"
    else
        echo "  âœ“ æ— å›¾æ ‡ï¼Œè·³è¿‡"
    fi
done

echo
echo "=== éªŒè¯æ¸…ç†ç»“æœ ==="

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å›¾æ ‡
remaining_files=$(find /root/scripts-for-linux -name "*.sh" -type f -exec grep -l "[ğŸš€ğŸ“¥âŒâœ…ğŸ§¹ğŸ”§ğŸšğŸ› ï¸ğŸ”ğŸ³ğŸ“¦ğŸ¯ğŸ’¡ğŸ”„âš ï¸ğŸ“ğŸ“‹ğŸ¨ğŸ‰ğŸ”ğŸŒğŸ‘¤ğŸâ­ï¸ğŸ”Œâš™ï¸ğŸ“]" {} \; 2>/dev/null | wc -l)

if [ "$remaining_files" -eq 0 ]; then
    echo "âœ“ æ‰€æœ‰å›¾æ ‡å·²æˆåŠŸæ¸…ç†"
else
    echo "âš  ä»æœ‰ $remaining_files ä¸ªæ–‡ä»¶åŒ…å«å›¾æ ‡"
    find /root/scripts-for-linux -name "*.sh" -type f -exec grep -l "[ğŸš€ğŸ“¥âŒâœ…ğŸ§¹ğŸ”§ğŸšğŸ› ï¸ğŸ”ğŸ³ğŸ“¦ğŸ¯ğŸ’¡ğŸ”„âš ï¸ğŸ“ğŸ“‹ğŸ¨ğŸ‰ğŸ”ğŸŒğŸ‘¤ğŸâ­ï¸ğŸ”Œâš™ï¸ğŸ“]" {} \; 2>/dev/null || true
fi

echo "=== æ¸…ç†å®Œæˆ ==="
